// Generated by CoffeeScript 1.10.0
(function() {
  var Gobgp, grpc, libgobgp, protoDescriptor;

  grpc = require('grpc');

  protoDescriptor = grpc.load(__dirname + "/deps/gobgp/api/gobgp.proto").gobgpapi;

  libgobgp = require('./build/Release/gobgp');

  Gobgp = (function() {
    Gobgp.AFI_IP = 1;

    Gobgp.AFI_IP6 = 2;

    Gobgp.SAFI_FLOW_SPEC_UNICAST = 133;

    Gobgp.RF_FS_IPv4_UC = Gobgp.AFI_IP << 16 | Gobgp.SAFI_FLOW_SPEC_UNICAST;

    Gobgp.RF_FS_IPv6_UC = Gobgp.AFI_IP6 << 16 | Gobgp.SAFI_FLOW_SPEC_UNICAST;

    function Gobgp(server) {
      this.stub = new protoDescriptor.GobgpApi(server, grpc.Credentials.createInsecure());
    }

    Gobgp.prototype.getRib = function(options, callback) {
      return this.stub.getRib(options, (function(_this) {
        return function(err, table) {
          if (err) {
            return console.error(err);
          }
          table.destinations.forEach(function(destination) {
            return destination.paths = destination.paths.map(function(path) {
              var decoded;
              decoded = JSON.parse(_this.decodePath(path));
              path.nlri = decoded.nlri.value;
              path.attrs = decoded.attrs;
              delete path.pattrs;
              return path;
            });
          });
          if (callback) {
            return callback(table);
          }
        };
      })(this));
    };

    Gobgp.prototype.modPath = function(family, path, callback) {
      if (typeof path === 'string') {
        path = this.serializePath(family, path);
      }
      return this.stub.modPath({
        path: path
      }, function(err, response) {
        if (err) {
          return console.error(err);
        }
        if (callback) {
          return callback(response);
        }
      });
    };

    Gobgp.prototype.serializePath = function(family, string) {
      return libgobgp.serialize_path(family, string);
    };

    Gobgp.prototype.decodePath = function(path) {
      return libgobgp.decode_path(path);
    };

    return Gobgp;

  })();

  module.exports = Gobgp;

}).call(this);
